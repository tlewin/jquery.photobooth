(function(c){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL;c.fn.photobooth=function(i,n,j){var a={width:300,height:225,imgPlaceholder:null,background:"#000000"};c.extend(!0,a,i);if(!navigator.getUserMedia&&!window.URL)if(j)j.call(null);else throw"Browser does not support video capturing.";return this.each(function(j,i){for(var l=c("<div></div>"),b=c("<video></video>"),f=c("<canvas></canvas"),
e=c("<img></img>"),d=null,o=c(i),m=[l,b,f,e],k=0;k<m.length;k++)m[k].attr({width:a.width,height:a.height});b.hide();f.hide();a.imgPlaceholder&&e.attr("src",a.imgPlaceholder);b.attr("autoplay",!0);b.css("background",a.background);n.call(null,{start:function(a){d?(e.hide(),b.show()):navigator.getUserMedia({audio:!1,video:!0},function(a){d=a;b.show();b.attr("src",window.URL.createObjectURL(d));e.hide()},function(){console.log("fail");a&&a.call(null)})},snapshot:function(){var c=f[0].getContext("2d"),
d=b[0].videoWidth/b[0].videoHeight,g=0,h=0;a.width/a.height>d?(h=a.height,g=Math.round(h*d)):(g=a.width,h=Math.round(g*Math.pow(d,-1)));c.fillStyle=a.background;c.fillRect(0,0,a.width,a.height);c.drawImage(b[0],a.width-g>>1,a.height-h>>1,g,h);b.hide();e.attr("src",f[0].toDataURL("image/png"));e.show()},stop:function(){d&&(d.stop(),d=null)}});o.append(l).append(b).append(f).append(e)})}})(jQuery);